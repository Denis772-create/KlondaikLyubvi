@page "/login"
@inject HttpClient Http
@inject NavigationManager Nav
@inject IJSRuntime JS

<link href="/login.css" rel="stylesheet" />

<div class="bg-gradient-to-br from-pink-100 to-rose-300 min-h-screen flex items-center justify-center font-sans">
    <div class="w-full max-w-md p-8 bg-white/80 backdrop-blur-md rounded-3xl shadow-2xl text-center space-y-8 animate-fade-in">
        <div class="flex items-center justify-center gap-2 mb-2">
            <span class="text-4xl">üîê</span>
            <span class="text-3xl font-extrabold text-pink-600 drop-shadow">–í–æ–π—Ç–∏ –≤ –ö–ª–∞–Ω–¥–∞–π–∫ –õ—é–±–≤–∏</span>
        </div>
        <p class="text-gray-600 text-lg">–ö—Ç–æ —Ç—ã —Å–µ–≥–æ–¥–Ω—è? <span class="text-pink-400">üòç</span></p>
        <form class="space-y-5" @onsubmit="OnLogin">
            <div class="relative">
                <select @bind="UserName" class="w-full rounded-xl border-pink-200 shadow px-4 py-3 focus:outline-none focus:ring-2 focus:ring-pink-400 text-lg bg-white appearance-none">
                    <option value="denis">üßî –î–µ–Ω–∏—Å</option>
                    <option value="liza">üë© –õ–∏–∑–∞</option>
                </select>
                <span class="absolute right-4 top-1/2 -translate-y-1/2 text-pink-300 pointer-events-none">‚ñº</span>
            </div>
            <div>
                <input type="password" @bind="Password" placeholder="–ü–∞—Ä–æ–ª—å" class="w-full rounded-xl border-pink-200 shadow px-4 py-3 focus:outline-none focus:ring-2 focus:ring-pink-400 text-lg bg-white" />
            </div>
            <div>
                <button type="submit" class="w-full bg-gradient-to-r from-pink-400 to-pink-500 hover:from-pink-500 hover:to-pink-600 text-white px-6 py-3 rounded-xl font-bold text-lg shadow transition-all duration-200 transform hover:scale-105 flex items-center justify-center gap-2">
                    <span class="text-xl">üíû</span> –í–æ–π—Ç–∏
                </button>
            </div>
            @if (!string.IsNullOrEmpty(Error))
            {
                <div class="text-red-500 font-semibold animate-shake">@Error</div>
            }
        </form>
        <div class="text-sm text-gray-400 mt-6">–¢–æ–ª—å–∫–æ –¥–ª—è –õ–∏–∑—ã –∏ –î–µ–Ω–∏—Å–∞ <span class="text-pink-400">‚ù§Ô∏è</span></div>
    </div>
</div>

@code {
    string UserName = "denis";
    string Password = "";
    string? Error;
    async Task OnLogin()
    {
        Error = null;
        var resp = await Http.PostAsJsonAsync("/api/login", new { UserName, Password });
        if (resp.IsSuccessStatusCode)
        {
            var userId = await resp.Content.ReadFromJsonAsync<int>();
            await JS.InvokeVoidAsync("blazorSetCookie", "userId", userId.ToString(), 7);
            // –ü–µ—Ä–µ–π–¥—ë–º –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å —Ñ–ª–∞–≥–æ–º –∑–∞–ø—É—Å–∫–∞ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞
            Nav.NavigateTo("/?onb=1", true);
        }
        else
        {
            Error = "–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å";
        }
    }
}